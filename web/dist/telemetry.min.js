(()=>{var Vt=Object.create;var St=Object.defineProperty;var Ft=Object.getOwnPropertyDescriptor;var Mt=Object.getOwnPropertyNames;var Wt=Object.getPrototypeOf,Kt=Object.prototype.hasOwnProperty;var Ht=(_,l)=>()=>(l||_((l={exports:{}}).exports,l),l.exports);var Jt=(_,l,p,n)=>{if(l&&typeof l=="object"||typeof l=="function")for(let S of Mt(l))!Kt.call(_,S)&&S!==p&&St(_,S,{get:()=>l[S],enumerable:!(n=Ft(l,S))||n.enumerable});return _};var Yt=(_,l,p)=>(p=_!=null?Vt(Wt(_)):{},Jt(l||!_||!_.__esModule?St(p,"default",{value:_,enumerable:!0}):p,_));var Ot=Ht((wt,Be)=>{(function(_,l){typeof define=="function"&&define.amd?define([],function(){return l(_.Countly)}):typeof Be=="object"&&Be.exports?Be.exports=l(_.Countly):_.Countly=l(_.Countly)})(typeof window<"u"?window:wt,function(_){if(typeof window>"u")return;_=_||{};var l={SESSIONS:"sessions",EVENTS:"events",VIEWS:"views",SCROLLS:"scrolls",CLICKS:"clicks",FORMS:"forms",CRASHES:"crashes",ATTRIBUTION:"attribution",USERS:"users",STAR_RATING:"star-rating",LOCATION:"location",APM:"apm",FEEDBACK:"feedback",REMOTE_CONFIG:"remote-config"};_.features=[l.SESSIONS,l.EVENTS,l.VIEWS,l.SCROLLS,l.CLICKS,l.FORMS,l.CRASHES,l.ATTRIBUTION,l.USERS,l.STAR_RATING,l.LOCATION,l.APM,l.FEEDBACK,l.REMOTE_CONFIG];var p={NPS:"[CLY]_nps",SURVEY:"[CLY]_survey",STAR_RATING:"[CLY]_star_rating",VIEW:"[CLY]_view",ORIENTATION:"[CLY]_orientation",PUSH_ACTION:"[CLY]_push_action",ACTION:"[CLY]_action"},n={ERROR:"[ERROR] ",WARNING:"[WARNING] ",INFO:"[INFO] ",DEBUG:"[DEBUG] ",VERBOSE:"[VERBOSE] "},S={DEVELOPER_SUPPLIED:0,SDK_GENERATED:1,TEMPORARY_ID:2,URL_PROVIDED:3},w={BEAT_INTERVAL:500,QUEUE_SIZE:1e3,FAIL_TIMEOUT_AMOUNT:60,INACTIVITY_TIME:20,SESSION_UPDATE:60,MAX_EVENT_BATCH:100,SESSION_COOKIE_TIMEOUT:30,MAX_KEY_LENGTH:128,MAX_VALUE_SIZE:256,MAX_SEGMENTATION_VALUES:30,MAX_BREADCRUMB_COUNT:100,MAX_STACKTRACE_LINES_PER_THREAD:30,MAX_STACKTRACE_LINE_LENGTH:200};_.q=_.q||[],_.onload=_.onload||[];var C="22.06.4",Pe="javascript_native_web",Ze=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,kt=function(a){var r=this,v=!_.i,y=!1,L="/i",F="/o/sdk",M=m("interval",a,w.BEAT_INTERVAL),J=m("queue_size",a,w.QUEUE_SIZE),A=[],U=[],P={},$=[],Z={},Y=m("ignore_referrers",a,[]),We=null,_e=!0,ne,Ke=0,X=null,he=0,ge=0,He=0,ke=m("fail_timeout",a,w.FAIL_TIMEOUT_AMOUNT),me=m("inactivity_time",a,w.INACTIVITY_TIME),pe=0,be=m("session_update",a,w.SESSION_UPDATE),ve=m("max_events",a,w.MAX_EVENT_BATCH),de=m("max_logs",a,null),re=m("use_session_cookie",a,!0),ye=m("session_cookie_timeout",a,w.SESSION_COOKIE_TIMEOUT),Ae=!0,xe=!1,G=m("offline_mode",a,!1),ee={},ae=!0,lt=D(),se=!0,le=null,B=S.SDK_GENERATED,Ee=!1,Re=0;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch(e){t(n.ERROR,"Local storage test failed, Halting local storage support: "+e),se=!1}for(var T={},Je=0;Je<_.features.length;Je++)T[_.features[Je]]={};this.initialize=function(){if(this.serialize=m("serialize",a,_.serialize),this.deserialize=m("deserialize",a,_.deserialize),this.getViewName=m("getViewName",a,_.getViewName),this.getViewUrl=m("getViewUrl",a,_.getViewUrl),this.getSearchQuery=m("getSearchQuery",a,_.getSearchQuery),this.DeviceIdType=_.DeviceIdType,this.namespace=m("namespace",a,""),this.clearStoredId=m("clear_stored_id",a,!1),this.app_key=m("app_key",a,null),this.onload=m("onload",a,[]),this.utm=m("utm",a,{source:!0,medium:!0,campaign:!0,term:!0,content:!0}),this.ignore_prefetch=m("ignore_prefetch",a,!0),this.rcAutoOptinAb=m("rc_automatic_optin_for_ab",a,!0),this.useExplicitRcApi=m("use_explicit_rc_api",a,!1),this.debug=m("debug",a,!1),this.test_mode=m("test_mode",a,!1),this.metrics=m("metrics",a,{}),this.headers=m("headers",a,{}),this.url=ce(m("url",a,"")),this.app_version=m("app_version",a,"0.0"),this.country_code=m("country_code",a,null),this.city=m("city",a,null),this.ip_address=m("ip_address",a,null),this.ignore_bots=m("ignore_bots",a,!0),this.force_post=m("force_post",a,!1),this.remote_config=m("remote_config",a,!1),this.ignore_visitor=m("ignore_visitor",a,!1),this.require_consent=m("require_consent",a,!1),this.track_domains=m("track_domains",a,!0),this.storage=m("storage",a,"default"),this.enableOrientationTracking=m("enable_orientation_tracking",a,!0),this.maxKeyLength=m("max_key_length",a,w.MAX_KEY_LENGTH),this.maxValueSize=m("max_value_size",a,w.MAX_VALUE_SIZE),this.maxSegmentationValues=m("max_segmentation_values",a,w.MAX_SEGMENTATION_VALUES),this.maxBreadcrumbCount=m("max_breadcrumb_count",a,null),this.maxStackTraceLinesPerThread=m("max_stack_trace_lines_per_thread",a,w.MAX_STACKTRACE_LINES_PER_THREAD),this.maxStackTraceLineLength=m("max_stack_trace_line_length",a,w.MAX_STACKTRACE_LINE_LENGTH),this.heatmapWhitelist=m("heatmap_whitelist",a,[]),de&&!this.maxBreadcrumbCount?(this.maxBreadcrumbCount=de,t(n.WARNING,"initialize, 'maxCrashLogs' is deprecated. Use 'maxBreadcrumbCount' instead!")):!de&&!this.maxBreadcrumbCount&&(this.maxBreadcrumbCount=100),this.storage==="cookie"&&(se=!1),!this.rcAutoOptinAb&&!this.useExplicitRcApi&&(t(n.WARNING,"initialize, Auto opting is disabled, switching to explicit RC API"),this.useExplicitRcApi=!0),Array.isArray(Y)||(Y=[]),this.url===""&&(t(n.ERROR,"initialize, Please provide server URL"),this.ignore_visitor=!0),N("cly_ignore")&&(this.ignore_visitor=!0),Pt(),this.clearStoredId&&(t(n.INFO,"initialize, Clearing the device ID storage"),localStorage.removeItem(this.app_key+"/cly_id"),localStorage.removeItem(this.app_key+"/cly_id_type")),A=N("cly_queue")||[],U=N("cly_event")||[],P=N("cly_remote_configs")||{},_t(),window.name&&window.name.indexOf("cly:")===0)try{this.passed_data=JSON.parse(window.name.replace("cly:",""))}catch(b){t(n.ERROR,"initialize, Could not parse name: "+window.name+", error: "+b)}else if(location.hash&&location.hash.indexOf("#cly:")===0)try{this.passed_data=JSON.parse(location.hash.replace("#cly:",""))}catch(b){t(n.ERROR,"initialize, Could not parse hash: "+location.hash+", error: "+b)}if((this.passed_data&&this.passed_data.app_key&&this.passed_data.app_key===this.app_key||this.passed_data&&!this.passed_data.app_key&&v)&&this.passed_data.token&&this.passed_data.purpose){this.passed_data.token!==N("cly_old_token")&&(yt(this.passed_data.token),R("cly_old_token",this.passed_data.token));var e=[];Array.isArray(this.heatmapWhitelist)?(this.heatmapWhitelist.push(this.url),e=this.heatmapWhitelist.map(function(b){return ce(b)})):e=[this.url],e.includes(this.passed_data.url)&&this.passed_data.purpose==="heatmap"&&(this.ignore_visitor=!0,ct(),ot(this.passed_data.url+"/views/heatmap.js",dt))}if(this.ignore_visitor){t(n.WARNING,"initialize, ignore_visitor:["+this.ignore_visitor+"], this user will not be tracked");return}t(n.DEBUG,"initialize, app_key:["+this.app_key+"], url:["+this.url+"]"),t(n.DEBUG,"initialize, device_id:["+m("device_id",a,void 0)+"]"),t(n.DEBUG,"initialize, require_consent is enabled:["+this.require_consent+"]");try{t(n.DEBUG,"initialize, metric override:["+JSON.stringify(this.metrics)+"]"),t(n.DEBUG,"initialize, header override:["+JSON.stringify(this.headers)+"]"),t(n.DEBUG,"initialize, number of onload callbacks provided:["+this.onload.length+"]"),t(n.DEBUG,"initialize, utm tags:["+JSON.stringify(this.utm)+"]"),Y&&t(n.DEBUG,"initialize, referrers to ignore :["+JSON.stringify(Y)+"]")}catch{t(n.ERROR,"initialize, Could not stringify some config object values")}t(n.DEBUG,"initialize, app_version:["+this.app_version+"]"),t(n.DEBUG,"initialize, provided location info; country_code:["+this.country_code+"], city:["+this.city+"], ip_address:["+this.ip_address+"]"),this.namespace!==""&&t(n.DEBUG,"initialize, namespace given:["+this.namespace+"]"),this.clearStoredId&&t(n.DEBUG,"initialize, clearStoredId flag set to:["+this.clearStoredId+"]"),this.ignore_prefetch&&t(n.DEBUG,"initialize, ignoring pre-fetching and pre-rendering from counting as real website visits :["+this.ignore_prefetch+"]"),this.test_mode&&t(n.WARNING,"initialize, test_mode:["+this.test_mode+"], queues won't be processed"),this.heatmapWhitelist&&t(n.DEBUG,"initialize, heatmap whitelist:["+JSON.stringify(this.heatmapWhitelist)+"], these domains will be whitelisted"),this.storage!=="default"&&t(n.DEBUG,"initialize, storage is set to:["+this.storage+"]"),this.ignore_bots&&t(n.DEBUG,"initialize, ignore traffic from bots :["+this.ignore_bots+"]"),this.force_post&&t(n.DEBUG,"initialize, forced post method for all requests:["+this.force_post+"]"),this.remote_config&&t(n.DEBUG,"initialize, remote_config callback provided:["+!!this.remote_config+"]"),typeof this.rcAutoOptinAb=="boolean"&&t(n.DEBUG,"initialize, automatic RC optin is enabled:["+this.rcAutoOptinAb+"]"),this.useExplicitRcApi||t(n.WARNING,"initialize, will use legacy RC API. Consider enabling new API during init with use_explicit_rc_api flag"),this.track_domains&&t(n.DEBUG,"initialize, tracking domain info:["+this.track_domains+"]"),this.enableOrientationTracking&&t(n.DEBUG,"initialize, enableOrientationTracking:["+this.enableOrientationTracking+"]"),re||t(n.WARNING,"initialize, use_session_cookie is enabled:["+re+"]"),G&&t(n.DEBUG,"initialize, offline_mode:["+G+"], user info won't be send to the servers"),G&&t(n.DEBUG,"initialize, stored remote configs:["+JSON.stringify(P)+"]"),t(n.DEBUG,"initialize, 'getViewName' callback override provided:["+!!this.getViewName+"]"),t(n.DEBUG,"initialize, 'getSearchQuery' callback override provided:["+!!this.getSearchQuery+"]"),this.maxKeyLength!==w.MAX_KEY_LENGTH&&t(n.DEBUG,"initialize, maxKeyLength set to:["+this.maxKeyLength+"] characters"),this.maxValueSize!==w.MAX_VALUE_SIZE&&t(n.DEBUG,"initialize, maxValueSize set to:["+this.maxValueSize+"] characters"),this.maxSegmentationValues!==w.MAX_SEGMENTATION_VALUES&&t(n.DEBUG,"initialize, maxSegmentationValues set to:["+this.maxSegmentationValues+"] key/value pairs"),this.maxBreadcrumbCount!==w.MAX_BREADCRUMB_COUNT&&t(n.DEBUG,"initialize, maxBreadcrumbCount for custom logs set to:["+this.maxBreadcrumbCount+"] entries"),this.maxStackTraceLinesPerThread!==w.MAX_STACKTRACE_LINES_PER_THREAD&&t(n.DEBUG,"initialize, maxStackTraceLinesPerThread set to:["+this.maxStackTraceLinesPerThread+"] lines"),this.maxStackTraceLineLength!==w.MAX_STACKTRACE_LINE_LENGTH&&t(n.DEBUG,"initialize, maxStackTraceLineLength set to:["+this.maxStackTraceLineLength+"] characters"),M!==w.BEAT_INTERVAL&&t(n.DEBUG,"initialize, interval for heartbeats set to:["+M+"] milliseconds"),J!==w.QUEUE_SIZE&&t(n.DEBUG,"initialize, queue_size set to:["+J+"] items max"),ke!==w.FAIL_TIMEOUT_AMOUNT&&t(n.DEBUG,"initialize, fail_timeout set to:["+ke+"] seconds of wait time after a failed connection to server"),me!==w.INACTIVITY_TIME&&t(n.DEBUG,"initialize, inactivity_time set to:["+me+"] minutes to consider a user as inactive after no observable action"),be!==w.SESSION_UPDATE&&t(n.DEBUG,"initialize, session_update set to:["+be+"] seconds to check if extending a session is needed while the user is active"),ve!==w.MAX_EVENT_BATCH&&t(n.DEBUG,"initialize, max_events set to:["+ve+"] events to send in one batch"),de&&t(n.WARNING,"initialize, max_logs set to:["+de+"] breadcrumbs to store for crash logs max, deprecated "),ye!==w.SESSION_COOKIE_TIMEOUT&&t(n.DEBUG,"initialize, session_cookie_timeout set to:["+ye+"] minutes to expire a cookies session"),t(n.INFO,"initialize, Countly initialized");var i=null,s=r.getSearchQuery(),d=!1,u={};if(s)for(var c=s.substring(1).split("&"),f=0;f<c.length;f++){var o=c[f].split("=");o[0]==="cly_id"?R("cly_cmp_id",o[1]):o[0]==="cly_uid"?R("cly_cmp_uid",o[1]):o[0]==="cly_device_id"?i=o[1]:(o[0]+"").indexOf("utm_")===0&&this.utm[o[0].replace("utm_","")]&&(u[o[0].replace("utm_","")]=o[1],d=!0)}var h=N("cly_id")==="[CLY]_temp_id",g=m("device_id",a,void 0);if(N("cly_id")&&!h?(this.device_id=N("cly_id"),t(n.INFO,"initialize, Set the stored device ID"),B=N("cly_id_type"),B||(t(n.INFO,"initialize, No device ID type info from the previous session, falling back to DEVELOPER_SUPPLIED"),B=S.DEVELOPER_SUPPLIED)):i!==null?(t(n.INFO,"initialize, Device ID set by URL"),this.device_id=i,B=S.URL_PROVIDED):g?(t(n.INFO,"initialize, Device ID set by developer"),this.device_id=g,a&&Object.keys(a).length?a.device_id!==void 0&&(B=S.DEVELOPER_SUPPLIED):_.device_id!==void 0&&(B=S.DEVELOPER_SUPPLIED)):G||h?(this.device_id="[CLY]_temp_id",B=S.TEMPORARY_ID,G&&h?t(n.INFO,"initialize, Temp ID set, continuing offline mode from previous app session"):G&&!h?t(n.INFO,"initialize, Temp ID set, entering offline mode"):(G=!0,t(n.INFO,"initialize, Temp ID set, enabling offline mode"))):(t(n.INFO,"initialize, Generating the device ID"),this.device_id=m("device_id",a,Qe()),a&&Object.keys(a).length?a.device_id!==void 0&&(B=S.DEVELOPER_SUPPLIED):_.device_id!==void 0&&(B=S.DEVELOPER_SUPPLIED)),R("cly_id",this.device_id),R("cly_id_type",B),d){for(var E in this.utm)u[E]?this.userData.set("utm_"+E,u[E]):this.userData.unset("utm_"+E);this.userData.save()}ht(),setTimeout(function(){De(),r.remote_config&&r.fetch_remote_config(r.remote_config)},1),document.documentElement.setAttribute("data-countly-useragent",ue())},this.halt=function(){t(n.WARNING,"halt, Resetting Countly"),_.i=void 0,v=!_.i,y=!1,L="/i",F="/o/sdk",M=500,J=1e3,A=[],U=[],P={},$=[],Z={},Y=[],We=null,_e=!0,Ke=0,X=null,he=0,ge=0,He=0,ke=60,me=20,pe=0,be=60,ve=100,de=null,re=!0,ye=30,Ae=!0,xe=!1,G=!1,ee={},ae=!0,lt=D(),se=!0,le=null,B=S.SDK_GENERATED,Ee=!1,Re=0;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch{t(n.ERROR,"halt, Local storage test failed, will fallback to cookies"),se=!1}_.features=[l.SESSIONS,l.EVENTS,l.VIEWS,l.SCROLLS,l.CLICKS,l.FORMS,l.CRASHES,l.ATTRIBUTION,l.USERS,l.STAR_RATING,l.LOCATION,l.APM,l.FEEDBACK,l.REMOTE_CONFIG],T={};for(var e=0;e<_.features.length;e++)T[_.features[e]]={};r.app_key=void 0,r.device_id=void 0,r.onload=void 0,r.utm=void 0,r.ignore_prefetch=void 0,r.debug=void 0,r.test_mode=void 0,r.metrics=void 0,r.headers=void 0,r.url=void 0,r.app_version=void 0,r.country_code=void 0,r.city=void 0,r.ip_address=void 0,r.ignore_bots=void 0,r.force_post=void 0,r.rcAutoOptinAb=void 0,r.useExplicitRcApi=void 0,r.remote_config=void 0,r.ignore_visitor=void 0,r.require_consent=void 0,r.track_domains=void 0,r.storage=void 0,r.enableOrientationTracking=void 0,r.maxKeyLength=void 0,r.maxValueSize=void 0,r.maxSegmentationValues=void 0,r.maxBreadcrumbCount=void 0,r.maxStackTraceLinesPerThread=void 0,r.maxStackTraceLineLength=void 0},this.group_features=function(e){if(t(n.INFO,"group_features, Grouping features"),e)for(var i in e)T[i]?t(n.WARNING,"group_features, Feature name ["+i+"] is already reserved"):typeof e[i]=="string"?T[i]={features:[e[i]]}:e[i]&&Array.isArray(e[i])&&e[i].length?T[i]={features:e[i]}:t(n.ERROR,"group_features, Incorrect feature list for ["+i+"] value: ["+e[i]+"]");else t(n.ERROR,"group_features, Incorrect features:["+e+"]")},this.check_consent=function(e){return t(n.INFO,"check_consent, Checking if consent is given for specific feature:["+e+"]"),this.require_consent?T[e]?!!(T[e]&&T[e].optin):(t(n.ERROR,"check_consent, No feature available for ["+e+"]"),!1):(t(n.INFO,"check_consent, require_consent is off, no consent is necessary"),!0)},this.get_device_id_type=function(){t(n.INFO,"check_device_id_type, Retrieving the current device id type.["+B+"]");var e;switch(B){case S.SDK_GENERATED:e=r.DeviceIdType.SDK_GENERATED;break;case S.URL_PROVIDED:case S.DEVELOPER_SUPPLIED:e=r.DeviceIdType.DEVELOPER_SUPPLIED;break;case S.TEMPORARY_ID:e=r.DeviceIdType.TEMPORARY_ID;break;default:e=-1;break}return e},this.get_device_id=function(){return t(n.INFO,"get_device_id, Retrieving the device id: ["+this.device_id+"]"),this.device_id},this.check_any_consent=function(){if(t(n.INFO,"check_any_consent, Checking if any consent is given"),!this.require_consent)return t(n.INFO,"check_any_consent, require_consent is off, no consent is necessary"),!0;for(var e in T)if(T[e]&&T[e].optin)return!0;return t(n.INFO,"check_any_consent, No consents given"),!1},this.add_consent=function(e){if(t(n.INFO,"add_consent, Adding consent for ["+e+"]"),Array.isArray(e))for(var i=0;i<e.length;i++)this.add_consent(e[i]);else T[e]?T[e].features?(T[e].optin=!0,this.add_consent(T[e].features)):T[e].optin!==!0&&(T[e].optin=!0,ft(),setTimeout(function(){e===l.SESSIONS&&ee.begin_session?(r.begin_session.apply(r,ee.begin_session),ee.begin_session=null):e===l.VIEWS&&ee.track_pageview&&(X=null,r.track_pageview.apply(r,ee.track_pageview),ee.track_pageview=null)},1)):t(n.ERROR,"add_consent, No feature available for ["+e+"]")},this.remove_consent=function(e){t(n.INFO,"remove_consent, Removing consent for ["+e+"]"),this.remove_consent_internal(e,!0)},this.remove_consent_internal=function(e,i){if(i=i||!1,Array.isArray(e))for(var s=0;s<e.length;s++)this.remove_consent_internal(e[s],i);else T[e]?T[e].features?this.remove_consent_internal(T[e].features,i):(T[e].optin=!1,i&&T[e].optin!==!1&&ft()):t(n.ERROR,"remove_consent, No feature available for ["+e+"]")};var Te,ft=function(){Te&&(clearTimeout(Te),Te=null),Te=setTimeout(function(){for(var e={},i=0;i<_.features.length;i++)T[_.features[i]].optin===!0?e[_.features[i]]=!0:e[_.features[i]]=!1;V({consent:JSON.stringify(e)}),t(n.DEBUG,"Consent update request has been sent to the queue.")},1e3)};this.enable_offline_mode=function(){t(n.INFO,"enable_offline_mode, Enabling offline mode"),this.remove_consent_internal(_.features,!1),G=!0,this.device_id="[CLY]_temp_id",B=S.TEMPORARY_ID},this.disable_offline_mode=function(e){t(n.INFO,"disable_offline_mode, Disabling offline mode"),G=!1,e&&this.device_id!==e?(this.device_id=e,B=S.DEVELOPER_SUPPLIED,R("cly_id",this.device_id),R("cly_id_type",S.DEVELOPER_SUPPLIED),t(n.INFO,"disable_offline_mode, Changing id to: "+this.device_id)):(this.device_id=Qe(),this.device_id!==N("cly_id")&&(R("cly_id",this.device_id),R("cly_id_type",S.SDK_GENERATED)));var i=!1;if(A.length>0)for(var s=0;s<A.length;s++)A[s].device_id==="[CLY]_temp_id"&&(A[s].device_id=this.device_id,i=!0);i&&R("cly_queue",A,!0)},this.begin_session=function(e,i){if(t(n.INFO,"begin_session, Starting the session"),e&&t(n.INFO,"begin_session, Heartbeats are disabled"),i&&t(n.INFO,"begin_session, Session starts irrespective of session cookie"),this.check_consent(l.SESSIONS)){if(!y){this.enableOrientationTracking&&(this.report_orientation(),I(window,"resize",function(){r.report_orientation()})),ne=D(),y=!0,_e=!e;var s=N("cly_session");if(i||!re||!s||parseInt(s)<=D()){t(n.INFO,"begin_session, Session started"),le===null&&(le=!0);var d={};d.begin_session=1,d.metrics=JSON.stringify(Le()),V(d)}R("cly_session",D()+ye*60)}}else ee.begin_session=arguments},this.session_duration=function(e){t(n.INFO,"session_duration, Reporting session duration"),this.check_consent(l.SESSIONS)&&y&&(t(n.INFO,"session_duration, Session extended: ",e),V({session_duration:e}),gt())},this.end_session=function(e,i){t(n.INFO,"end_session, Ending the current session"),this.check_consent(l.SESSIONS)&&y&&(e=e||D()-ne,je(),!re||i?(t(n.INFO,"end_session, Session ended"),V({end_session:1,session_duration:e})):this.session_duration(e),y=!1)},this.change_id=function(e,i){if(t(n.INFO,"change_id, Changing the ID"),i&&t(n.INFO,"change_id, Will merge the IDs"),!e||typeof e!="string"||e.length===0){t(n.ERROR,"change_id, The provided ID: ["+e+"] is not a valid ID");return}if(G){t(n.WARNING,"change_id, Offline mode was on, initiating disabling sequence instead."),this.disable_offline_mode(e);return}if(this.device_id!==e){i||(Ye(),this.end_session(null,!0),Z={},this.remove_consent_internal(_.features,!1));var s=this.device_id;this.device_id=e,B=S.DEVELOPER_SUPPLIED,R("cly_id",this.device_id),R("cly_id_type",S.DEVELOPER_SUPPLIED),t(n.INFO,"change_id, Changing ID from:["+s+"] to ["+e+"]"),i?V({old_device_id:s}):this.begin_session(!_e,!0),this.remote_config&&(P={},R("cly_remote_configs",P),this.fetch_remote_config(this.remote_config))}},this.add_event=function(e){t(n.INFO,"add_event, Adding event: ",e);var i=!1;switch(e.key){case p.NPS:i=this.check_consent("feedback");break;case p.SURVEY:i=this.check_consent("feedback");break;case p.STAR_RATING:i=this.check_consent("star-rating");break;case p.VIEW:i=this.check_consent("views");break;case p.ORIENTATION:i=this.check_consent("users");break;case p.PUSH_ACTION:i=this.check_consent("push");break;case p.ACTION:i=this.check_consent("clicks")||this.check_consent("scroll");break;default:i=this.check_consent("events")}i&&K(e)};function K(e){if(r.ignore_visitor){t(n.ERROR,"Adding event failed. Possible bot or user opt out");return}if(!e.key){t(n.ERROR,"Adding event failed. Event must have a key property");return}e.count||(e.count=1),e.key=O(e.key,r.maxKeyLength,"add_cly_event",t),e.segmentation=Q(e.segmentation,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"add_cly_event",t);var i=["key","count","sum","dur","segmentation"],s=fe(e,i);s.timestamp=ze();var d=new Date;s.hour=d.getHours(),s.dow=d.getDay(),U.push(s),R("cly_event",U),t(n.INFO,"Successfully adding event: ",e)}this.start_event=function(e){if(t(n.INFO,"start_event, Starting timed event with key: ["+e+"]"),e=O(e,r.maxKeyLength,"start_event",t),Z[e]){t(n.WARNING,"start_event, Timed event with key ["+e+"] already started");return}Z[e]=D()},this.end_event=function(e){if(t(n.INFO,"end_event, Ending timed event"),typeof e=="string"&&(e={key:e}),!e.key){t(n.ERROR,"end_event, Timed event must have a key property");return}if(!Z[e.key]){t(n.ERROR,"end_event, Timed event with key ["+e.key+"] was not started");return}e.dur=D()-Z[e.key],this.add_event(e),delete Z[e.key]},this.report_orientation=function(e){t(n.INFO,"report_orientation, Reporting orientation"),this.check_consent(l.USERS)&&K({key:p.ORIENTATION,segmentation:{mode:e||xt()}})},this.report_conversion=function(e,i){t(n.WARNING,"report_conversion, Deprecated function call! Use 'recordDirectAttribution' in place of this call. Call will be redirected now!"),this.recordDirectAttribution(e,i)},this.recordDirectAttribution=function(e,i){t(n.INFO,"recordDirectAttribution, Recording the attribution for campaign ID: ["+e+"] and the user ID: ["+i+"]"),this.check_consent(l.ATTRIBUTION)&&(e=e||N("cly_cmp_id")||"cly_organic",i=i||N("cly_cmp_uid"),V(i?{campaign_id:e,campaign_user:i}:{campaign_id:e}))},this.user_details=function(e){if(t(n.INFO,"user_details, Trying to add user details: ",e),this.check_consent(l.USERS)){e.name=O(e.name,r.maxValueSize,"user_details",t),e.username=O(e.username,r.maxValueSize,"user_details",t),e.email=O(e.email,r.maxValueSize,"user_details",t),e.organization=O(e.organization,r.maxValueSize,"user_details",t),e.phone=O(e.phone,r.maxValueSize,"user_details",t),e.picture=O(e.picture,4096,"user_details",t),e.gender=O(e.gender,r.maxValueSize,"user_details",t),e.byear=O(e.byear,r.maxValueSize,"user_details",t),e.custom=Q(e.custom,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"user_details",t);var i=["name","username","email","organization","phone","picture","gender","byear","custom"];V({user_details:JSON.stringify(fe(e,i))})}};var j={},te=function(e,i,s){r.check_consent(l.USERS)&&(j[e]||(j[e]={}),s==="$push"||s==="$pull"||s==="$addToSet"?(j[e][s]||(j[e][s]=[]),j[e][s].push(i)):j[e][s]=i)};this.userData={set:function(e,i){t(n.INFO,"set, Setting user's custom property value: ["+i+"] under the key: ["+e+"]"),e=O(e,r.maxKeyLength,"userData set",t),i=O(i,r.maxValueSize,"userData set",t),j[e]=i},unset:function(e){t(n.INFO,"unset, Resetting user's custom property with key: ["+e+"] "),j[e]=""},set_once:function(e,i){t(n.INFO,"set_once, Setting user's unique custom property value: ["+i+"] under the key: ["+e+"] "),e=O(e,r.maxKeyLength,"userData set_once",t),i=O(i,r.maxValueSize,"userData set_once",t),te(e,i,"$setOnce")},increment:function(e){t(n.INFO,"increment, Increasing user's custom property value under the key: ["+e+"] by one"),e=O(e,r.maxKeyLength,"userData increment",t),te(e,1,"$inc")},increment_by:function(e,i){t(n.INFO,"increment_by, Increasing user's custom property value under the key: ["+e+"] by: ["+i+"]"),e=O(e,r.maxKeyLength,"userData increment_by",t),i=O(i,r.maxValueSize,"userData increment_by",t),te(e,i,"$inc")},multiply:function(e,i){t(n.INFO,"multiply, Multiplying user's custom property value under the key: ["+e+"] by: ["+i+"]"),e=O(e,r.maxKeyLength,"userData multiply",t),i=O(i,r.maxValueSize,"userData multiply",t),te(e,i,"$mul")},max:function(e,i){t(n.INFO,"max, Saving user's maximum custom property value compared to the value: ["+i+"] under the key: ["+e+"]"),e=O(e,r.maxKeyLength,"userData max",t),i=O(i,r.maxValueSize,"userData max",t),te(e,i,"$max")},min:function(e,i){t(n.INFO,"min, Saving user's minimum custom property value compared to the value: ["+i+"] under the key: ["+e+"]"),e=O(e,r.maxKeyLength,"userData min",t),i=O(i,r.maxValueSize,"userData min",t),te(e,i,"$min")},push:function(e,i){t(n.INFO,"push, Pushing a value: ["+i+"] under the key: ["+e+"] to user's custom property array"),e=O(e,r.maxKeyLength,"userData push",t),i=O(i,r.maxValueSize,"userData push",t),te(e,i,"$push")},push_unique:function(e,i){t(n.INFO,"push_unique, Pushing a unique value: ["+i+"] under the key: ["+e+"] to user's custom property array"),e=O(e,r.maxKeyLength,"userData push_unique",t),i=O(i,r.maxValueSize,"userData push_unique",t),te(e,i,"$addToSet")},pull:function(e,i){t(n.INFO,"pull, Removing the value: ["+i+"] under the key: ["+e+"] from user's custom property array"),te(e,i,"$pull")},save:function(){t(n.INFO,"save, Saving changes to user's custom property"),r.check_consent(l.USERS)&&V({user_details:JSON.stringify({custom:j})}),j={}}},this.report_trace=function(e){if(t(n.INFO,"report_trace, Reporting performance trace"),this.check_consent(l.APM)){for(var i=["type","name","stz","etz","apm_metrics","apm_attr"],s=0;s<i.length;s++)if(i[s]!=="apm_attr"&&typeof e[i[s]]>"u"){t(n.WARNING,"report_trace, APM trace don't have the property: "+i[s]);return}e.name=O(e.name,r.maxKeyLength,"report_trace",t),e.app_metrics=Q(e.app_metrics,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"report_trace",t);var d=fe(e,i);d.timestamp=e.stz;var u=new Date;d.hour=u.getHours(),d.dow=u.getDay(),V({apm:JSON.stringify(d)}),t(n.INFO,"report_trace, Successfully adding APM trace: ",d)}},this.track_errors=function(e){t(n.INFO,"track_errors, Started tracking errors"),_.i[this.app_key].tracking_crashes=!0,window.cly_crashes||(window.cly_crashes=!0,We=e,window.onerror=function i(s,d,u,c,f){if(f!=null)Ve(f,!1);else{c=c||window.event&&window.event.errorCharacter;var o="";typeof s<"u"&&(o+=s+`
`),typeof d<"u"&&(o+="at "+d),typeof u<"u"&&(o+=":"+u),typeof c<"u"&&(o+=":"+c),o+=`
`;try{for(var h=[],g=i.caller;g;)h.push(g.name),g=g.caller;o+=h.join(`
`)}catch(E){t(n.ERROR,"track_errors, Call stack generation experienced a problem: "+E)}Ve(o,!1)}},window.addEventListener("unhandledrejection",function(i){Ve(new Error("Unhandled rejection (reason: "+(i.reason&&i.reason.stack?i.reason.stack:i.reason)+")."),!0)}))},this.log_error=function(e,i){t(n.INFO,"log_error, Logging errors"),this.recordError(e,!0,i)},this.add_log=function(e){if(t(n.INFO,"add_log, Adding a new log of breadcrumbs: [ "+e+" ]"),this.check_consent(l.CRASHES)){for(e=O(e,r.maxValueSize,"add_log",t);$.length>=r.maxBreadcrumbCount;)$.shift(),t(n.WARNING,"add_log, Reached maximum crashLogs size. Will erase the oldest one.");$.push(e)}},this.fetch_remote_config=function(e,i,s){var d=null,u=null,c=null;if(e&&(!s&&typeof e=="function"?c=e:Array.isArray(e)&&(d=e)),i&&(!s&&typeof i=="function"?c=i:Array.isArray(i)&&(u=i)),!c&&typeof s=="function"&&(c=s),this.useExplicitRcApi){t(n.INFO,"fetch_remote_config, Fetching remote config");var f=this.rcAutoOptinAb?1:0;ut(d,u,f,null,c);return}t(n.WARNING,"fetch_remote_config, Fetching remote config, with legacy API"),ut(d,u,null,"legacy",c)};function ut(e,i,s,d,u){t(n.INFO,"fetch_remote_config_explicit, Fetching sequence initiated");var c={method:"rc"};e&&(c.keys=JSON.stringify(e)),i&&(c.omit_keys=JSON.stringify(i));var f;d==="legacy"&&(c.method="fetch_remote_config"),s===0&&(c.oi=0),s===1&&(c.oi=1),typeof u=="function"&&(f=u),r.check_consent(l.SESSIONS)&&(c.metrics=JSON.stringify(Le())),r.check_consent(l.REMOTE_CONFIG)?(qe(c),ie("fetch_remote_config_explicit",r.url+F,c,function(o,h,g){if(o){t(n.ERROR,"fetch_remote_config_explicit, An error occurred: "+o);return}try{var E=JSON.parse(g);if(c.keys||c.omit_keys)for(var b in E)P[b]=E[b];else P=E;R("cly_remote_configs",P)}catch(x){t(n.ERROR,"fetch_remote_config_explicit, Had an issue while parsing the response: "+x)}f&&(t(n.INFO,"fetch_remote_config_explicit, Callback function is provided"),f(o,P))},!0)):(t(n.ERROR,"fetch_remote_config_explicit, Remote config requires explicit consent"),f&&f(new Error("Remote config requires explicit consent"),P))}this.enrollUserToAb=function(e){if(t(n.INFO,"enrollUserToAb, Providing AB test keys to opt in for"),!e||!Array.isArray(e)||e.length===0){t(n.ERROR,"enrollUserToAb, No keys provided");return}var i={method:"ab",keys:JSON.stringify(e)};qe(i),ie("enrollUserToAb",this.url+F,i,function(s,d,u){if(s){t(n.ERROR,"enrollUserToAb, An error occurred: "+s);return}try{var c=JSON.parse(u);t(n.DEBUG,"enrollUserToAb, Parsed the response's result: ["+c.result+"]")}catch(f){t(n.ERROR,"enrollUserToAb, Had an issue while parsing the response: "+f)}},!0)},this.get_remote_config=function(e){return t(n.INFO,"get_remote_config, Getting remote config from storage"),typeof e<"u"?P[e]:P},this.stop_time=function(){t(n.INFO,"stop_time, Stopping tracking duration"),ae&&(ae=!1,Ke=D()-ne,ge=D()-he)},this.start_time=function(){t(n.INFO,"start_time, Starting tracking duration"),ae||(ae=!0,ne=D()-Ke,he=D()-ge,ge=0,gt())},this.track_sessions=function(){t(n.INFO,"track_session, Starting tracking user session"),this.begin_session(),this.start_time(),I(window,"beforeunload",function(){Ye(),r.end_session()});var e="hidden";function i(){document[e]||!document.hasFocus()?r.stop_time():r.start_time()}I(window,"focus",i),I(window,"blur",i),I(window,"pageshow",i),I(window,"pagehide",i),"onfocusin"in document&&(I(window,"focusin",i),I(window,"focusout",i)),e in document?document.addEventListener("visibilitychange",i):"mozHidden"in document?(e="mozHidden",document.addEventListener("mozvisibilitychange",i)):"webkitHidden"in document?(e="webkitHidden",document.addEventListener("webkitvisibilitychange",i)):"msHidden"in document&&(e="msHidden",document.addEventListener("msvisibilitychange",i));function s(){pe>=me&&r.start_time(),pe=0}I(window,"mousemove",s),I(window,"click",s),I(window,"keydown",s),I(window,"scroll",s),setInterval(function(){pe++,pe>=me&&r.stop_time()},6e4)},this.track_pageview=function(e,i,s){if(t(n.INFO,"track_pageview, Tracking page views"),t(n.VERBOSE,"track_pageview, last view is:["+X+"]"),X&&(t(n.DEBUG,"track_pageview, Scroll registry triggered"),$e(),Ee=!0,Re=0),je(),e=O(e,r.maxKeyLength,"track_pageview",t),e&&Array.isArray(e)&&(i=e,e=null),e||(e=this.getViewName()),e===void 0||e===""){t(n.ERROR,"track_pageview, No page name to track (it is either undefined or empty string). No page view can be tracked.");return}if(e===null){t(n.ERROR,"track_pageview, View name returned as null. Page view will be ignored.");return}if(i&&i.length)for(var d=0;d<i.length;d++)try{var u=new RegExp(i[d]);if(u.test(e)){t(n.INFO,"track_pageview, Ignoring the page: "+e);return}}catch(g){t(n.ERROR,"track_pageview, Problem with finding ignore list item: "+i[d]+", error: "+g)}X=e,he=D(),t(n.VERBOSE,"track_pageview, last view is assigned:["+X+"]");var c={name:e,visit:1,view:r.getViewUrl()};if(c=Q(c,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"track_pageview",t),this.track_domains&&(c.domain=window.location.hostname),re)if(y)le&&(le=!1,c.start=1);else{var f=N("cly_session");(!f||parseInt(f)<=D())&&(le=!1,c.start=1)}else if(typeof document.referrer<"u"&&document.referrer.length){var o=Ze.exec(document.referrer);o&&o[11]&&o[11]!==window.location.hostname&&(c.start=1)}if(s){s=Q(s,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"track_pageview",t);for(var h in s)typeof c[h]>"u"&&(c[h]=s[h])}this.check_consent(l.VIEWS)?K({key:p.VIEW,segmentation:c}):ee.track_pageview=arguments},this.track_view=function(e,i,s){t(n.INFO,"track_view, Initiating tracking page views"),this.track_pageview(e,i,s)},this.track_clicks=function(e){t(n.INFO,"track_clicks, Starting to track clicks"),e&&t(n.INFO,"track_clicks, Tracking the specified children:["+e+"]"),e=e||document;var i=!0;function s(d){if(i){if(i=!1,Fe(d),typeof d.pageX<"u"&&typeof d.pageY<"u"){var u=Ie(),c=Me();if(r.check_consent(l.CLICKS)){var f={type:"click",x:d.pageX,y:d.pageY,width:c,height:u,view:r.getViewUrl()};f=Q(f,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"processClick",t),r.track_domains&&(f.domain=window.location.hostname),K({key:p.ACTION,segmentation:f})}}setTimeout(function(){i=!0},1e3)}}I(e,"click",s)},this.track_scrolls=function(e){t(n.INFO,"track_scrolls, Starting to track scrolls"),e&&t(n.INFO,"track_scrolls, Tracking the specified children"),e=e||window,Ee=!0,I(e,"scroll",vt),I(e,"beforeunload",$e)},this.track_links=function(e){t(n.INFO,"track_links, Starting to track clicks to links"),e&&t(n.INFO,"track_links, Tracking the specified children"),e=e||document;function i(s){var d=At(Oe(s),"a");d&&(Fe(s),r.check_consent(l.CLICKS)&&K({key:"linkClick",segmentation:{href:d.href,text:d.innerText,id:d.id,view:r.getViewUrl()}}))}I(e,"click",i)},this.track_forms=function(e,i){t(n.INFO,"track_forms, Starting to track form submissions. DOM object provided:["+!!e+"] Tracking hidden inputs :["+!!i+"]"),e=e||document;function s(u){return u.name||u.id||u.type||u.nodeName}function d(u){var c=Oe(u),f={id:c.attributes.id&&c.attributes.id.nodeValue,name:c.attributes.name&&c.attributes.name.nodeValue,action:c.attributes.action&&c.attributes.action.nodeValue,method:c.attributes.method&&c.attributes.method.nodeValue,view:r.getViewUrl()},o;if(typeof c.elements<"u"){for(var h=0;h<c.elements.length;h++)o=c.elements[h],o&&o.type!=="password"&&o.className.indexOf("cly_user_ignore")===-1&&(typeof f["input:"+s(o)]>"u"&&(f["input:"+s(o)]=[]),o.nodeName.toLowerCase()==="select"?typeof o.multiple<"u"?f["input:"+s(o)].push(et(o)):f["input:"+s(o)].push(o.options[o.selectedIndex].value):o.nodeName.toLowerCase()==="input"?typeof o.type<"u"?o.type.toLowerCase()==="checkbox"||o.type.toLowerCase()==="radio"?o.checked&&f["input:"+s(o)].push(o.value):(o.type.toLowerCase()!=="hidden"||i)&&f["input:"+s(o)].push(o.value):f["input:"+s(o)].push(o.value):(o.nodeName.toLowerCase()==="textarea"||typeof o.value<"u")&&f["input:"+s(o)].push(o.value));for(var g in f)f[g]&&typeof f[g].join=="function"&&(f[g]=f[g].join(", "))}r.check_consent(l.FORMS)&&K({key:"formSubmit",segmentation:f})}I(e,"submit",d)},this.collect_from_forms=function(e,i){t(n.INFO,"collect_from_forms, Starting to collect possible user data. DOM object provided:["+!!e+"] Submitting custom user property:["+!!i+"]"),e=e||document;function s(d){var u=Oe(d),c={},f=!1,o;if(typeof u.elements<"u"){var h={},g=e.getElementsByTagName("LABEL"),E,b;for(E=0;E<g.length;E++)g[E].htmlFor&&g[E].htmlFor!==""&&(h[g[E].htmlFor]=g[E].innerText||g[E].textContent||g[E].innerHTML);for(E=0;E<u.elements.length;E++)if(o=u.elements[E],o&&o.type!=="password"&&o.className.indexOf("cly_user_ignore")===-1){var x="";if(o.nodeName.toLowerCase()==="select"?typeof o.multiple<"u"?x=et(o):x=o.options[o.selectedIndex].value:o.nodeName.toLowerCase()==="input"?typeof o.type<"u"&&(o.type.toLowerCase()==="checkbox"||o.type.toLowerCase()==="radio")?o.checked&&(x=o.value):x=o.value:(o.nodeName.toLowerCase()==="textarea"||typeof o.value<"u")&&(x=o.value),o.className&&o.className.indexOf("cly_user_")!==-1){var H=o.className.split(" ");for(b=0;b<H.length;b++)if(H[b].indexOf("cly_user_")===0){c[H[b].replace("cly_user_","")]=x,f=!0;break}}else o.type&&o.type.toLowerCase()==="email"||o.name&&o.name.toLowerCase().indexOf("email")!==-1||o.id&&o.id.toLowerCase().indexOf("email")!==-1||o.id&&h[o.id]&&h[o.id].toLowerCase().indexOf("email")!==-1||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(x)?(c.email||(c.email=x),f=!0):o.name&&o.name.toLowerCase().indexOf("username")!==-1||o.id&&o.id.toLowerCase().indexOf("username")!==-1||o.id&&h[o.id]&&h[o.id].toLowerCase().indexOf("username")!==-1?(c.username||(c.username=x),f=!0):o.name&&(o.name.toLowerCase().indexOf("tel")!==-1||o.name.toLowerCase().indexOf("phone")!==-1||o.name.toLowerCase().indexOf("number")!==-1)||o.id&&(o.id.toLowerCase().indexOf("tel")!==-1||o.id.toLowerCase().indexOf("phone")!==-1||o.id.toLowerCase().indexOf("number")!==-1)||o.id&&h[o.id]&&(h[o.id].toLowerCase().indexOf("tel")!==-1||h[o.id].toLowerCase().indexOf("phone")!==-1||h[o.id].toLowerCase().indexOf("number")!==-1)?(c.phone||(c.phone=x),f=!0):o.name&&(o.name.toLowerCase().indexOf("org")!==-1||o.name.toLowerCase().indexOf("company")!==-1)||o.id&&(o.id.toLowerCase().indexOf("org")!==-1||o.id.toLowerCase().indexOf("company")!==-1)||o.id&&h[o.id]&&(h[o.id].toLowerCase().indexOf("org")!==-1||h[o.id].toLowerCase().indexOf("company")!==-1)?(c.organization||(c.organization=x),f=!0):(o.name&&o.name.toLowerCase().indexOf("name")!==-1||o.id&&o.id.toLowerCase().indexOf("name")!==-1||o.id&&h[o.id]&&h[o.id].toLowerCase().indexOf("name")!==-1)&&(c.name||(c.name=""),c.name+=x+" ",f=!0)}}f&&(t(n.INFO,"collect_from_forms, Gathered user data",c),i?r.user_details({custom:c}):r.user_details(c))}I(e,"submit",s)},this.collect_from_facebook=function(e){t(n.INFO,"collect_from_facebook, Starting to collect possible user data"),FB&&FB.api&&FB.api("/me",function(i){var s={};if(i.name&&(s.name=i.name),i.email&&(s.email=i.email),i.gender==="male"?s.gender="M":i.gender==="female"&&(s.gender="F"),i.birthday){var d=i.birthday.split("/").pop();d&&d.length===4&&(s.byear=d)}if(i.work&&i.work[0]&&i.work[0].employer&&i.work[0].employer.name&&(s.organization=i.work[0].employer.name),e){s.custom={};for(var u in e){for(var c=e[u].split("."),f=i,o=0;o<c.length&&(f=f[c[o]],!(typeof f>"u"));o++);typeof f<"u"&&(s.custom[u]=f)}}r.user_details(s)})},this.opt_out=function(){t(n.INFO,"opt_out, Opting out the user"),this.ignore_visitor=!0,R("cly_ignore",!0)},this.opt_in=function(){t(n.INFO,"opt_in, Opting in the user"),R("cly_ignore",!1),this.ignore_visitor=!1,_t(),!this.ignore_visitor&&!xe&&De()},this.report_feedback=function(e){t(n.WARNING,"report_feedback, Deprecated function call! Use 'recordRatingWidgetWithID' or 'reportFeedbackWidgetManually' in place of this call. Call will be redirected to 'recordRatingWidgetWithID' now!"),this.recordRatingWidgetWithID(e)},this.recordRatingWidgetWithID=function(e){if(t(n.INFO,"recordRatingWidgetWithID, Providing information about user with ID: [ "+e.widget_id+" ]"),!!this.check_consent(l.STAR_RATING)){if(!e.widget_id){t(n.ERROR,"recordRatingWidgetWithID, Rating Widget must contain widget_id property");return}if(!e.rating){t(n.ERROR,"recordRatingWidgetWithID, Rating Widget must contain rating property");return}var i=["widget_id","contactMe","platform","app_version","rating","email","comment"],s={key:p.STAR_RATING,count:1,segmentation:{}};s.segmentation=fe(e,i),s.segmentation.app_version||(s.segmentation.app_version=this.metrics._app_version||this.app_version),s.segmentation.rating>5?(t(n.WARNING,"recordRatingWidgetWithID, You have entered a rating higher than 5. Changing it back to 5 now."),s.segmentation.rating=5):s.segmentation.rating<1&&(t(n.WARNING,"recordRatingWidgetWithID, You have entered a rating lower than 1. Changing it back to 1 now."),s.segmentation.rating=1),t(n.INFO,"recordRatingWidgetWithID, Reporting Rating Widget: ",s),K(s)}},this.reportFeedbackWidgetManually=function(e,i,s){if(this.check_consent(l.FEEDBACK)){if(!(e&&i)){t(n.ERROR,"reportFeedbackWidgetManually, Widget data and/or Widget object not provided. Aborting.");return}if(!e._id){t(n.ERROR,"reportFeedbackWidgetManually, Feedback Widgets must contain _id property");return}if(G){t(n.ERROR,"reportFeedbackWidgetManually, Feedback Widgets can not be reported in offline mode");return}t(n.INFO,"reportFeedbackWidgetManually, Providing information about user with, provided result of the widget with  ID: [ "+e._id+" ] and type: ["+e.type+"]");var d=[],u=e.type,c;if(u==="nps"){if(s){if(!s.rating){t(n.ERROR,"reportFeedbackWidgetManually, Widget must contain rating property");return}s.rating=Math.round(s.rating),s.rating>10?(t(n.WARNING,"reportFeedbackWidgetManually, You have entered a rating higher than 10. Changing it back to 10 now."),s.rating=10):s.rating<0&&(t(n.WARNING,"reportFeedbackWidgetManually, You have entered a rating lower than 0. Changing it back to 0 now."),s.rating=0),d=["rating","comment"]}c=p.NPS}else if(u==="survey"){if(s){if(Object.keys(s).length<1){t(n.ERROR,"reportFeedbackWidgetManually, Widget should have answers to be reported");return}d=Object.keys(s)}c=p.SURVEY}else if(u==="rating"){if(s){if(!s.rating){t(n.ERROR,"reportFeedbackWidgetManually, Widget must contain rating property");return}s.rating=Math.round(s.rating),s.rating>5?(t(n.WARNING,"reportFeedbackWidgetManually, You have entered a rating higher than 5. Changing it back to 5 now."),s.rating=5):s.rating<1&&(t(n.WARNING,"reportFeedbackWidgetManually, You have entered a rating lower than 1. Changing it back to 1 now."),s.rating=1),d=["rating","comment","email","contactMe"]}c=p.STAR_RATING}else{t(n.ERROR,"reportFeedbackWidgetManually, Widget has an unacceptable type");return}var f={key:c,count:1,segmentation:{widget_id:e._id,platform:this.platform,app_version:this.metrics._app_version||this.app_version}};s===null?f.segmentation.closed=1:f.segmentation=bt(f.segmentation,s,d),t(n.INFO,"reportFeedbackWidgetManually, Reporting "+u+": ",f),K(f)}},this.show_feedback_popup=function(e){t(n.WARNING,"show_feedback_popup, Deprecated function call! Use 'presentRatingWidgetWithID' in place of this call. Call will be redirected now!"),this.presentRatingWidgetWithID(e)},this.presentRatingWidgetWithID=function(e){t(n.INFO,"presentRatingWidgetWithID, Showing rating widget popup for the widget with ID: [ "+e+" ]"),this.check_consent(l.STAR_RATING)&&(G?t(n.ERROR,"presentRatingWidgetWithID, Cannot show ratingWidget popup in offline mode"):ie("presentRatingWidgetWithID",this.url+"/o/feedback/widget",{widget_id:e},function(i,s,d){if(i){t(n.ERROR,"presentRatingWidgetWithID, An error occurred: "+i);return}try{var u=JSON.parse(d);Xe(u,!1)}catch(c){t(n.ERROR,"presentRatingWidgetWithID, JSON parse failed: "+c)}},!0))},this.initialize_feedback_popups=function(e){t(n.WARNING,"initialize_feedback_popups, Deprecated function call! Use 'initializeRatingWidgets' in place of this call. Call will be redirected now!"),this.initializeRatingWidgets(e)},this.initializeRatingWidgets=function(e){if(t(n.INFO,"initializeRatingWidgets, Initializing rating widget with provided widget IDs:[ "+e+"]"),!!this.check_consent(l.STAR_RATING)){e||(e=N("cly_fb_widgets"));for(var i=document.getElementsByClassName("countly-feedback-sticker");i.length>0;)i[0].remove();ie("initializeRatingWidgets",this.url+"/o/feedback/multiple-widgets-by-id",{widgets:JSON.stringify(e)},function(s,d,u){if(s){t(n.ERROR,"initializeRatingWidgets, An error occurred: "+s);return}try{for(var c=JSON.parse(u),f=0;f<c.length;f++)if(c[f].is_active==="true"){var o=c[f].target_devices,h=nt();if(o[h])if(typeof c[f].hide_sticker=="string"&&(c[f].hide_sticker=c[f].hide_sticker==="true"),c[f].target_page==="all"&&!c[f].hide_sticker)Xe(c[f],!0);else for(var g=c[f].target_pages,E=0;E<g.length;E++){var b=g[E].substr(0,g[E].length-1)===window.location.pathname.substr(0,g[E].length-1),x=g[E]===window.location.pathname,H=g[E].includes("*");(H&&b||x)&&!c[f].hide_sticker&&Xe(c[f],!0)}}}catch(z){t(n.ERROR,"initializeRatingWidgets, JSON parse error: "+z)}},!0)}},this.enable_feedback=function(e){t(n.WARNING,"enable_feedback, Deprecated function call! Use 'enableRatingWidgets' in place of this call. Call will be redirected now!"),this.enableRatingWidgets(e)},this.enableRatingWidgets=function(e){if(t(n.INFO,"enableRatingWidgets, Enabling rating widget with params:",e),!!this.check_consent(l.STAR_RATING))if(G)t(n.ERROR,"enableRatingWidgets, Cannot enable rating widgets in offline mode");else{R("cly_fb_widgets",e.popups||e.widgets),Ne(this.url+"/star-rating/stylesheets/countly-feedback-web.css");var i=e.popups||e.widgets;i.length>0?(document.body.insertAdjacentHTML("beforeend",'<div id="cfbg"></div>'),this.initializeRatingWidgets(i)):t(n.ERROR,"enableRatingWidgets, You should provide at least one widget id as param. Read documentation for more detail. https://resources.count.ly/plugins/feedback")}},this.get_available_feedback_widgets=function(e){if(t(n.INFO,"get_available_feedback_widgets, Getting the feedback list, callback function is provided:["+!!e+"]"),!this.check_consent(l.FEEDBACK)){e&&e(null,new Error("Consent for feedback not provided."));return}if(G){t(n.ERROR,"get_available_feedback_widgets, Cannot enable feedback widgets in offline mode.");return}var i=this.url+F,s={method:l.FEEDBACK,device_id:this.device_id,app_key:this.app_key};ie("get_available_feedback_widgets",i,s,function(d,u,c){if(d){t(n.ERROR,"get_available_feedback_widgets, Error occurred while fetching feedbacks: "+d),e&&e(null,d);return}try{var f=JSON.parse(c),o=f.result||[];e&&e(o,null);return}catch(h){t(n.ERROR,"get_available_feedback_widgets, Error while parsing feedback widgets list: "+h),e&&e(null,h)}},!1)},this.getFeedbackWidgetData=function(e,i){if(!e.type){t(n.ERROR,"getFeedbackWidgetData, Expected the provided widget object to have a type but got: ["+JSON.stringify(e)+"], aborting.");return}if(t(n.INFO,"getFeedbackWidgetData, Retrieving data for: ["+JSON.stringify(e)+"], callback function is provided:["+!!i+"]"),!this.check_consent(l.FEEDBACK)){i&&i(null,new Error("Consent for feedback not provided."));return}if(G){t(n.ERROR,"getFeedbackWidgetData, Cannot enable feedback widgets in offline mode.");return}var s=this.url,d={widget_id:e._id,shown:1,sdk_version:C,sdk_name:Pe,platform:this.platform,app_version:this.app_version};if(e.type==="nps")s+="/o/surveys/nps/widget";else if(e.type==="survey")s+="/o/surveys/survey/widget";else if(e.type==="rating")s+="/o/surveys/rating/widget";else{t(n.ERROR,"getFeedbackWidgetData, Unknown type info: ["+e.type+"]");return}ie("getFeedbackWidgetData",s,d,u,!0);function u(c,f,o){if(c){t(n.ERROR,"getFeedbackWidgetData, Error occurred while fetching feedbacks: "+c),i&&i(null,c);return}try{var h=JSON.parse(o);i&&i(h,null);return}catch(g){t(n.ERROR,"getFeedbackWidgetData, Error while parsing feedback widgets list: "+g),i&&i(null,g)}}},this.present_feedback_widget=function(e,i,s){if(t(n.INFO,"present_feedback_widget, Presenting the feedback widget by appending to the element with ID: [ "+i+" ] and className: [ "+s+" ]"),!this.check_consent(l.FEEDBACK))return;if(!e||typeof e!="object"||Array.isArray(e)){t(n.ERROR,"present_feedback_widget, Please provide at least one feedback widget object.");return}try{var d=this.url;if(e.type==="nps")t(n.DEBUG,"present_feedback_widget, Widget type: nps."),d+="/feedback/nps";else if(e.type==="survey")t(n.DEBUG,"present_feedback_widget, Widget type: survey."),d+="/feedback/survey";else if(e.type==="rating")t(n.DEBUG,"present_feedback_widget, Widget type: rating."),d+="/feedback/rating";else{t(n.ERROR,"present_feedback_widget, Feedback widget only accepts nps, rating and survey types.");return}var u=window.origin||window.location.origin,c;e.type==="rating"?(t(n.DEBUG,"present_feedback_widget, Loading css for rating widget."),c="ratings",Ne(this.url+"/star-rating/stylesheets/countly-feedback-web.css")):(t(n.DEBUG,"present_feedback_widget, Loading css for survey or nps."),Ne(this.url+"/surveys/stylesheets/countly-surveys.css"),c="surveys"),d+="?widget_id="+e._id,d+="&app_key="+this.app_key,d+="&device_id="+this.device_id,d+="&sdk_name="+Pe,d+="&platform="+this.platform,d+="&app_version="+this.app_version,d+="&sdk_version="+C,d+="&origin="+u,d+="&widget_v=web";var f=document.createElement("iframe");f.src=d,f.name="countly-"+c+"-iframe",f.id="countly-"+c+"-iframe";var o=!1;f.onload=function(){o&&(document.getElementById("countly-"+c+"-wrapper-"+e._id).style.display="none",document.getElementById("csbg").style.display="none"),o=!0,t(n.DEBUG,"present_feedback_widget, Loaded iframe.")};for(var h=document.getElementById("csbg");h;)h.remove(),h=document.getElementById("csbg"),t(n.DEBUG,"present_feedback_widget, Removing past overlay.");for(var g=document.getElementsByClassName("countly-"+c+"-wrapper"),E=0;E<g.length;E++)g[E].remove(),t(n.DEBUG,"present_feedback_widget, Removed a wrapper.");g=document.createElement("div"),g.className="countly-"+c+"-wrapper",g.id="countly-"+c+"-wrapper-"+e._id,e.type==="survey"&&(g.className=g.className+" "+e.appearance.position);var b=document.body,x=!1;if(i&&(document.getElementById(i)?(b=document.getElementById(i),x=!0):t(n.ERROR,"present_feedback_widget, Provided ID not found.")),x||s&&(document.getElementsByClassName(s)[0]?b=document.getElementsByClassName(s)[0]:t(n.ERROR,"present_feedback_widget, Provided class not found.")),b.insertAdjacentHTML("beforeend",'<div id="csbg"></div>'),b.appendChild(g),e.type==="rating"){var H=document.createElement("div");H.className="countly-ratings-overlay",H.id="countly-ratings-overlay-"+e._id,g.appendChild(H),t(n.DEBUG,"present_feedback_widget, appended the rating overlay to wrapper"),I(document.getElementById("countly-ratings-overlay-"+e._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+e._id).style.display="none"})}if(g.appendChild(f),t(n.DEBUG,"present_feedback_widget, Appended the iframe"),I(window,"message",function(k){var W={};try{W=JSON.parse(k.data),t(n.DEBUG,"present_feedback_widget, Parsed response message "+W)}catch(zt){t(n.ERROR,"present_feedback_widget, Error while parsing message body "+zt)}if(!W.close){t(n.DEBUG,"present_feedback_widget, Closing signal not sent yet");return}document.getElementById("countly-"+c+"-wrapper-"+e._id).style.display="none",document.getElementById("csbg").style.display="none"}),e.type==="survey"){var z=!1;switch(e.showPolicy){case"afterPageLoad":document.readyState==="complete"?z||(z=!0,oe(e)):I(document,"readystatechange",function(k){k.target.readyState==="complete"&&(z||(z=!0,oe(e)))});break;case"afterConstantDelay":setTimeout(function(){z||(z=!0,oe(e))},1e4);break;case"onAbandon":document.readyState==="complete"?I(document,"mouseleave",function(){z||(z=!0,oe(e))}):I(document,"readystatechange",function(k){k.target.readyState==="complete"&&I(document,"mouseleave",function(){z||(z=!0,oe(e))})});break;case"onScrollHalfwayDown":I(window,"scroll",function(){if(!z){var k=Math.max(window.scrollY,document.body.scrollTop,document.documentElement.scrollTop),W=Ie();k>=W/2&&(z=!0,oe(e))}});break;default:z||(z=!0,oe(e))}}else if(e.type==="nps")document.getElementById("countly-"+c+"-wrapper-"+e._id).style.display="block",document.getElementById("csbg").style.display="block";else if(e.type==="rating"){var Ue=!1;document.readyState==="complete"?Ue||(Ue=!0,Rt(e)):I(document,"readystatechange",function(k){k.target.readyState==="complete"&&(Ue||(Ue=!0,Rt(e)))})}}catch(k){t(n.ERROR,"present_feedback_widget, Something went wrong while presenting the widget: "+k)}function oe(k){document.getElementById("countly-surveys-wrapper-"+k._id).style.display="block",document.getElementById("csbg").style.display="block"}function Rt(k){if(!k.appearance.hideS){t(n.DEBUG,"present_feedback_widget, handling the sticker as it was not set to hidden");var W=document.createElement("div");W.innerText=k.appearance.text,W.style.color=k.appearance.text_color.length<7?"#"+k.appearance.text_color:k.appearance.text_color,W.style.backgroundColor=k.appearance.bg_color.length<7?"#"+k.appearance.bg_color:k.appearance.bg_color,W.className="countly-feedback-sticker  "+k.appearance.position+"-"+k.appearance.size,W.id="countly-feedback-sticker-"+k._id,document.body.appendChild(W),I(document.getElementById("countly-feedback-sticker-"+k._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+k._id).style.display="flex",document.getElementById("csbg").style.display="block"})}I(document.getElementById("countly-feedback-close-icon-"+k._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+k._id).style.display="none",document.getElementById("csbg").style.display="none"})}},this.recordError=function(e,i,s){if(t(n.INFO,"recordError, Recording error"),this.check_consent(l.CRASHES)&&e){s=s||We;var d="";if(typeof e=="object"?typeof e.stack<"u"?d=e.stack:(typeof e.name<"u"&&(d+=e.name+":"),typeof e.message<"u"&&(d+=e.message+`
`),typeof e.fileName<"u"&&(d+="in "+e.fileName+`
`),typeof e.lineNumber<"u"&&(d+="on "+e.lineNumber),typeof e.columnNumber<"u"&&(d+=":"+e.columnNumber)):d=e+"",d.length>r.maxStackTraceLineLength*r.maxStackTraceLinesPerThread){t(n.DEBUG,"record_error, Error stack is too long will be truncated");var u=d.split(`
`);u.length>r.maxStackTraceLinesPerThread&&(u=u.splice(0,r.maxStackTraceLinesPerThread));for(var c=0,f=u.length;c<f;c++)u[c].length>r.maxStackTraceLineLength&&(u[c]=u[c].substring(0,r.maxStackTraceLineLength));d=u.join(`
`)}i=!!i;var o=Le(),h={_resolution:o._resolution,_error:d,_app_version:o._app_version,_run:D()-lt};h._not_os_specific=!0,h._javascript=!0;var g=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery;g&&(h._bat=Math.floor(g.level*100)),typeof navigator.onLine<"u"&&(h._online=!!navigator.onLine),h._background=!document.hasFocus(),$.length>0&&(h._logs=$.join(`
`)),$=[],h._nonfatal=i,h._view=this.getViewName(),typeof s<"u"&&(s=Q(s,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"record_error",t),h._custom=s);try{var E=document.createElement("canvas"),b=E.getContext("experimental-webgl");h._opengl=b.getParameter(b.VERSION)}catch(H){t(n.ERROR,"Could not get the experimental-webgl context: "+H)}var x={};x.crash=JSON.stringify(h),x.metrics=JSON.stringify({_ua:o._ua}),V(x)}};function _t(){r.ignore_prefetch&&typeof document.visibilityState<"u"&&document.visibilityState==="prerender"&&(r.ignore_visitor=!0),r.ignore_bots&&rt()&&(r.ignore_visitor=!0)}function Ye(){U.length>0&&(V({events:JSON.stringify(U)}),U=[],R("cly_event",U))}function Xe(e,i){var s=!!document.getElementById("countly-feedback-sticker-"+e._id);if(s){t(n.ERROR,"Widget with same ID exists");return}try{var d=document.createElement("div");d.className="countly-iframe-wrapper",d.id="countly-iframe-wrapper-"+e._id;var u=document.createElement("span");u.className="countly-feedback-close-icon",u.id="countly-feedback-close-icon-"+e._id,u.innerText="x";var c=document.createElement("iframe");if(c.name="countly-feedback-iframe",c.id="countly-feedback-iframe",c.src=r.url+"/feedback?widget_id="+e._id+"&app_key="+r.app_key+"&device_id="+r.device_id+"&sdk_version="+C,document.body.appendChild(d),d.appendChild(u),d.appendChild(c),I(document.getElementById("countly-feedback-close-icon-"+e._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+e._id).style.display="none",document.getElementById("cfbg").style.display="none"}),i){var f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.id="feedback-sticker-svg",f.setAttribute("aria-hidden","true"),f.setAttribute("data-prefix","far"),f.setAttribute("data-icon","grin"),f.setAttribute("class","svg-inline--fa fa-grin fa-w-16"),f.setAttribute("role","img"),f.setAttribute("xmlns","http://www.w3.org/2000/svg"),f.setAttribute("viewBox","0 0 496 512");var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.id="smileyPathInStickerSvg",o.setAttribute("fill","white"),o.setAttribute("d","M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm105.6-151.4c-25.9 8.3-64.4 13.1-105.6 13.1s-79.6-4.8-105.6-13.1c-9.9-3.1-19.4 5.4-17.7 15.3 7.9 47.1 71.3 80 123.3 80s115.3-32.9 123.3-80c1.6-9.8-7.7-18.4-17.7-15.3zM168 240c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z");var h=document.createElement("span");h.innerText=e.trigger_button_text;var g=document.createElement("div");g.style.color=e.trigger_font_color.length<7?"#"+e.trigger_font_color:e.trigger_font_color,g.style.backgroundColor=e.trigger_bg_color.length<7?"#"+e.trigger_bg_color:e.trigger_bg_color,g.className="countly-feedback-sticker  "+e.trigger_position+"-"+e.trigger_size,g.id="countly-feedback-sticker-"+e._id,f.appendChild(o),g.appendChild(f),g.appendChild(h),document.body.appendChild(g);var E=document.getElementById("smileyPathInStickerSvg");E&&(E.style.fill=e.trigger_font_color.length<7?"#"+e.trigger_font_color:e.trigger_font_color),I(document.getElementById("countly-feedback-sticker-"+e._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+e._id).style.display="block",document.getElementById("cfbg").style.display="block"})}else document.getElementById("countly-iframe-wrapper-"+e._id).style.display="block",document.getElementById("cfbg").style.display="block"}catch(b){t(n.ERROR,"Somethings went wrong while element injecting process: "+b)}}function ht(){var e;if(typeof r.onload<"u"&&r.onload.length>0){for(e=0;e<r.onload.length;e++)typeof r.onload[e]=="function"&&r.onload[e](r);r.onload=[]}}function je(){if(X){var e={name:X};r.check_consent(l.VIEWS)&&K({key:p.VIEW,dur:ae?D()-he:ge,segmentation:e}),X=null}}function Tt(){return X}function gt(){if(re){var e=N("cly_session");(!e||parseInt(e)<=D())&&(y=!1,r.begin_session(!_e)),R("cly_session",D()+ye*60)}}function qe(e){e.app_key=r.app_key,e.device_id=r.device_id,e.sdk_name=Pe,e.sdk_version=C,e.t=B,r.check_consent(l.LOCATION)?(r.country_code&&(e.country_code=r.country_code),r.city&&(e.city=r.city),r.ip_address!==null&&(e.ip_address=r.ip_address)):e.location="",e.timestamp=ze();var i=new Date;e.hour=i.getHours(),e.dow=i.getDay()}function V(e){if(r.ignore_visitor){t(n.WARNING,"User is opt_out will ignore the request: "+e);return}if(!r.app_key||!r.device_id){t(n.ERROR,"app_key or device_id is missing ",r.app_key,r.device_id);return}qe(e),A.length>J&&A.shift(),A.push(e),R("cly_queue",A,!0)}function De(){if(ht(),r.ignore_visitor){xe=!1,t(n.WARNING,"User opt_out, no heartbeat");return}xe=!0;var e=0;if(v&&typeof _.q<"u"&&_.q.length>0){var i,s=_.q;for(_.q=[],e=0;e<s.length;e++)if(i=s[e],t(n.DEBUG,"Processing queued call",i),typeof i=="function")i();else if(Array.isArray(i)&&i.length>0){var d=r,u=0;if(_.i[i[u]]&&(d=_.i[i[u]],u++),typeof d[i[u]]=="function")d[i[u]].apply(d,i.slice(u+1));else if(i[u].indexOf("userData.")===0){var c=i[u].replace("userData.","");typeof d.userData[c]=="function"&&d.userData[c].apply(d,i.slice(u+1))}else typeof _[i[u]]=="function"&&_[i[u]].apply(_,i.slice(u+1))}}if(y&&_e&&ae){var f=D();f-ne>be&&(r.session_duration(f-ne),ne=f)}if(U.length>0){if(U.length<=ve)V({events:JSON.stringify(U)}),U=[];else{var o=U.splice(0,ve);V({events:JSON.stringify(o)})}R("cly_event",U)}if(!G&&A.length>0&&Ae&&D()>He){Ae=!1;var h=A[0];t(n.DEBUG,"Processing request",h),R("cly_queue",A,!0),r.test_mode||ie("send_request_queue",r.url+L,h,function(g,E){t(n.DEBUG,"Request Finished",E,g),g?(He=D()+ke,t(n.ERROR,"Request error: ",g)):A.shift(),R("cly_queue",A,!0),Ae=!0},!1)}setTimeout(De,M)}function Qe(){var e=N("cly_id");return e?(B=N("cly_id_type"),e):tt()}function Dt(e){return/[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-4[0-9a-fA-F]{3}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}/.test(e)}function Le(){var e=JSON.parse(JSON.stringify(r.metrics||{}));if(e._app_version=e._app_version||r.app_version,e._ua=e._ua||ue(),screen.width){var i=screen.width?parseInt(screen.width):0,s=screen.height?parseInt(screen.height):0;if(i!==0&&s!==0){var d=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);if(d&&window.devicePixelRatio)i=Math.round(i*window.devicePixelRatio),s=Math.round(s*window.devicePixelRatio);else if(Math.abs(window.orientation)===90){var u=i;i=s,s=u}e._resolution=e._resolution||""+i+"x"+s}}window.devicePixelRatio&&(e._density=e._density||window.devicePixelRatio);var c=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;if(typeof c<"u"&&(e._locale=e._locale||c),typeof document.referrer<"u"&&document.referrer.length){var f=Ze.exec(document.referrer);if(f&&f[11]&&f[11]!==window.location.hostname){var o=!1;if(Y&&Y.length)for(var h=0;h<Y.length;h++)try{var g=new RegExp(Y[h]);if(g.test(document.referrer)){t(n.DEBUG,"Ignored: "+document.referrer),o=!0;break}}catch(E){t(n.ERROR,"Problem with ignoring: "+Y[h],", error: "+E)}o||(e._store=e._store||document.referrer)}}return t(n.DEBUG,"Got metrics",e),e}function t(e,i){if(r.debug&&typeof console<"u"){arguments[2]&&typeof arguments[2]=="object"&&(arguments[2]=JSON.stringify(arguments[2])),v||(i="["+r.app_key+"] "+i),e||(e=n.DEBUG);for(var s="",d=2;d<arguments.length;d++)s+=arguments[d];var u=e+i+s;e===n.ERROR?console.error(u):e===n.WARNING?console.warn(u):e===n.INFO?console.info(u):e===n.VERBOSE?console.log(u):console.debug(u)}}function ie(e,i,s,d,u){u=u||!1;try{t(n.DEBUG,"Sending XML HTTP request");var c=null;window.XMLHttpRequest?c=new window.XMLHttpRequest:window.ActiveXObject&&(c=new window.ActiveXObject("Microsoft.XMLHTTP")),s=s||{};var f=it(s),o="GET";(r.force_post||f.length>=2e3)&&(o="POST"),o==="GET"?c.open("GET",i+"?"+f,!0):(c.open("POST",i,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"));for(var h in r.headers)c.setRequestHeader(h,r.headers[h]);c.onreadystatechange=function(){if(this.readyState===4){t(n.DEBUG,e+" HTTP request completed ["+this.status+"]["+this.responseText+"]");var g;u?g=pt(this.status,this.responseText):g=mt(this.status,this.responseText),g?typeof d=="function"&&d(!1,s,this.responseText):(t(n.ERROR,e+" Failed Server XML HTTP request, ",this.status),typeof d=="function"&&d(!0,s))}},o==="GET"?c.send():c.send(f)}catch(g){t(n.ERROR,e+" Failed XML HTTP request: "+g),typeof d=="function"&&d(!0,s)}}function mt(e,i){if(!(e>=200&&e<300))return t(n.ERROR,"Http response status code is not within the expected range:["+e+"]"),!1;try{var s=JSON.parse(i);return Object.prototype.toString.call(s)!=="[object Object]"?(t(n.ERROR,"Http response is not JSON Object"),!1):!!s.result}catch(d){return t(n.ERROR,"Http response is not JSON: "+d),!1}}function pt(e,i){if(!(e>=200&&e<300))return t(n.ERROR,"Http response status code is not within the expected range: "+e),!1;try{var s=JSON.parse(i);return Object.prototype.toString.call(s)!=="[object Object]"&&!Array.isArray(s)?(t(n.ERROR,"Http response is not JSON Object nor JSON Array"),!1):!0}catch(d){return t(n.ERROR,"Http response is not JSON: "+d),!1}}function vt(){Re=Math.max(Re,window.scrollY,document.body.scrollTop,document.documentElement.scrollTop)}function $e(){if(Ee){Ee=!1;var e=Ie(),i=Me(),s=at();if(r.check_consent(l.SCROLLS)){var d={type:"scroll",y:Re+s,width:i,height:e,view:r.getViewUrl()};d=Q(d,r.maxKeyLength,r.maxValueSize,r.maxSegmentationValues,"processScrollView",t),r.track_domains&&(d.domain=window.location.hostname),K({key:p.ACTION,segmentation:d})}}}function Lt(){return B}function yt(e){R("cly_token",e)}function Ut(){var e=N("cly_token");return q("cly_token"),e}function Bt(){return U}function Ct(){return A}function Gt(e){for(var i=e+"=",s=document.cookie.split(";"),d=0,u=s.length;d<u;d++){for(var c=s[d];c.charAt(0)===" ";)c=c.substring(1,c.length);if(c.indexOf(i)===0)return c.substring(i.length,c.length)}return null}function Et(e,i,s){var d=new Date;d.setTime(d.getTime()+s*24*60*60*1e3);var u="; expires="+d.toGMTString();document.cookie=e+"="+i+u+"; path=/"}function N(e,i,s){if(r.storage==="none"){t(n.WARNING,"Storage is disabled. Value with key: "+e+" won't be retrieved");return}s||(e=r.app_key+"/"+e,r.namespace&&(e=ce(r.namespace)+"/"+e)),i===void 0&&(i=se);var d;return i?d=localStorage.getItem(e):r.storage!=="localstorage"&&(d=Gt(e)),r.deserialize(d)}function R(e,i,s,d){if(r.storage==="none"){t(n.WARNING,"Storage is disabled. Value with key: "+e+" won't be stored");return}d||(e=r.app_key+"/"+e,r.namespace&&(e=ce(r.namespace)+"/"+e)),s===void 0&&(s=se),typeof i<"u"&&i!==null&&(i=r.serialize(i),s?localStorage.setItem(e,i):r.storage!=="localstorage"&&Et(e,i,30))}function q(e,i,s){if(r.storage==="none"){t(n.WARNING,"Storage is disabled. Value with key: "+e+" won't be removed");return}s||(e=r.app_key+"/"+e,r.namespace&&(e=ce(r.namespace)+"/"+e)),i===void 0&&(i=se),i?localStorage.removeItem(e):r.storage!=="localstorage"&&Et(e,"",-1)}function Pt(){if(N(r.namespace+"cly_id",!1,!0)){R("cly_id",N(r.namespace+"cly_id",!1,!0)),R("cly_id_type",N(r.namespace+"cly_id_type",!1,!0)),R("cly_event",N(r.namespace+"cly_event",!1,!0)),R("cly_session",N(r.namespace+"cly_session",!1,!0));var e=N(r.namespace+"cly_queue",!1,!0);Array.isArray(e)&&(e=e.filter(function(i){return i.app_key===r.app_key}),R("cly_queue",e)),N(r.namespace+"cly_cmp_id",!1,!0)&&(R("cly_cmp_id",N(r.namespace+"cly_cmp_id",!1,!0)),R("cly_cmp_uid",N(r.namespace+"cly_cmp_uid",!1,!0))),N(r.namespace+"cly_ignore",!1,!0)&&R("cly_ignore",N(r.namespace+"cly_ignore",!1,!0)),q("cly_id",!1,!0),q("cly_id_type",!1,!0),q("cly_event",!1,!0),q("cly_session",!1,!0),q("cly_queue",!1,!0),q("cly_cmp_id",!1,!0),q("cly_cmp_uid",!1,!0),q("cly_ignore",!1,!0)}}this.onStorageChange=function(e,i){switch(t(n.INFO,"onStorageChange, Applying storage changes"),e){case"cly_queue":A=r.deserialize(i||"[]");break;case"cly_event":U=r.deserialize(i||"[]");break;case"cly_remote_configs":P=r.deserialize(i||"{}");break;case"cly_ignore":r.ignore_visitor=r.deserialize(i);break;case"cly_id":r.device_id=r.deserialize(i);break;case"cly_id_type":B=r.deserialize(i);break;default:}},this._internals={store:R,getDocWidth:Me,getDocHeight:Ie,getViewportHeight:at,get_page_coord:Fe,get_event_target:Oe,add_event:I,createNewObjectFromProperties:fe,truncateObject:Q,truncateSingleValue:O,stripTrailingSlash:ce,prepareParams:it,sendXmlHttpRequest:ie,isResponseValid:mt,getInternalDeviceIdType:Lt,getMsTimestamp:ze,getTimestamp:D,isResponseValidBroad:pt,log:t,getMetrics:Le,generateUUID:tt,sendEventsForced:Ye,isUUID:Dt,getId:Qe,heartBeat:De,toRequestQueue:V,reportViewDuration:je,loadJS:ot,loadCSS:Ne,getLastView:Tt,setToken:yt,getToken:Ut,showLoader:ct,hideLoader:dt,setValueInStorage:R,getValueFromStorage:N,removeValueFromStorage:q,add_cly_events:K,processScrollView:$e,processScroll:vt,currentUserAgentString:ue,userAgentDeviceDetection:nt,userAgentSearchBotDetection:rt,getRequestQueue:Ct,getEventQueue:Bt,clearQueue:function(){A=[],R("cly_queue",[]),U=[],R("cly_event",[])}},this.initialize()};_.CountlyClass=kt,_.init=function(a){a=a||{};var r=a.app_key||_.app_key;if(!_.i||!_.i[r]){var v=new _.CountlyClass(a);if(!_.i){_.i={};for(var y in v)_[y]=v[y]}_.i[r]=v}return _.i[r]};function et(a){var r=[];if(typeof a.options<"u")for(var v=0;v<a.options.length;v++)a.options[v].selected&&r.push(a.options[v].value);return r.join(", ")}function tt(){var a=new Date().getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(v){var y=(a+Math.random()*16)%16|0;return a=Math.floor(a/16),(v==="x"?y:y&3|8).toString(16)});return r}function D(){return Math.floor(new Date().getTime()/1e3)}var we=0;function ze(){var a=new Date().getTime();return we>=a?we++:we=a,we}function m(a,r,v){if(r&&Object.keys(r).length){if(typeof r[a]<"u")return r[a]}else if(typeof _[a]<"u")return _[a];return v}function Ve(a,r,v){for(var y in _.i)_.i[y].tracking_crashes&&_.i[y].recordError(a,r,v)}function it(a){var r=[];for(var v in a)r.push(v+"="+encodeURIComponent(a[v]));return r.join("&")}function ce(a){return typeof a=="string"&&a.substring(a.length-1)==="/"?a.substring(0,a.length-1):a}function fe(a,r){for(var v={},y,L=0,F=r.length;L<F;L++)y=r[L],typeof a[y]<"u"&&(v[y]=a[y]);return v}function bt(a,r,v){if(v){for(var y,L=0,F=v.length;L<F;L++)y=v[L],typeof r[y]<"u"&&(a[y]=r[y]);return a}}function Q(a,r,v,y,L,F){var M={};if(a){if(Object.keys(a).length>y){var J={},A=0;for(var U in a)A<y&&(J[U]=a[U],A++);a=J}for(var P in a){var $=O(P,r,L,F),Z=O(a[P],v,L,F);M[$]=Z}}return M}function O(a,r,v,y){var L=a;return typeof a=="number"&&(a=a.toString()),typeof a=="string"&&a.length>r&&(L=a.substring(0,r),y(n.DEBUG,v+", Key: [ "+a+" ] is longer than accepted length. It will be truncated.")),L}var At=function(a,r){for(r=r.toUpperCase();a;){if(a.nodeName.toUpperCase()===r)return a;a=a.parentElement}},I=function(a,r,v){typeof a.addEventListener<"u"?a.addEventListener(r,v,!1):a.attachEvent("on"+r,v)},Oe=function(a){return a?typeof a.target<"u"?a.target:a.srcElement:window.event.srcElement};function ue(a){if(a)return a;var r=navigator.userAgent;return r||navigator.userAgentData&&(r=navigator.userAgentData.brands.map(function(v){return v.brand+":"+v.version}).join(),r+=navigator.userAgentData.mobile?" mobi ":" ",r+=navigator.userAgentData.platform),r}function nt(a){var r;if(a)r=a;else{if(navigator.userAgentData.mobile)return"phone";r=ue()}r=r.toLowerCase();var v="desktop",y=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/,L=/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/;return y.test(r)?v="tablet":L.test(r)&&(v="phone"),v}function rt(a){var r=/(CountlySiteBot|nuhk|Googlebot|GoogleSecurityScanner|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO|contxbot|PingdomBot|BingPreview|HeadlessChrome)/;return r.test(a||ue())}function Fe(a){return typeof a.pageY>"u"&&typeof a.clientX=="number"&&document.documentElement&&(a.pageX=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a.pageY=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),a}function Ie(){var a=document;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}function Me(){var a=document;return Math.max(Math.max(a.body.scrollWidth,a.documentElement.scrollWidth),Math.max(a.body.offsetWidth,a.documentElement.offsetWidth),Math.max(a.body.clientWidth,a.documentElement.clientWidth))}function at(){var a=document;return Math.min(Math.min(a.body.clientHeight,a.documentElement.clientHeight),Math.min(a.body.offsetHeight,a.documentElement.offsetHeight),window.innerHeight)}function xt(){return window.innerWidth>window.innerHeight?"landscape":"portrait"}window.addEventListener("storage",function(a){var r=(a.key+"").split("/"),v=r.pop(),y=r.pop();_.i&&_.i[y]&&_.i[y].onStorageChange(v,a.newValue)});function st(a,r,v,y,L,F){var M=document.createElement(a),J;M.setAttribute(r,v),M.setAttribute(y,L);var A=function(){J||F(),J=!0};F&&(M.onreadystatechange=A,M.onload=A),document.getElementsByTagName("head")[0].appendChild(M)}function ot(a,r){st("script","type","text/javascript","src",a,r)}function Ne(a,r){st("link","rel","stylesheet","href",a,r)}function ct(){var a=document.getElementById("cly-loader");if(!a){var r="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}",v=document.head||document.getElementsByTagName("head")[0],y=document.createElement("style");y.type="text/css",y.styleSheet?y.styleSheet.cssText=r:y.appendChild(document.createTextNode(r)),v.appendChild(y),a=document.createElement("div"),a.setAttribute("id","cly-loader"),document.body.onload=function(){if(!_.showLoaderProtection)try{document.body.appendChild(a)}catch{}}}a.style.display="block"}function dt(){_.showLoaderProtection=!0;var a=document.getElementById("cly-loader");a&&(a.style.display="none")}return _.serialize=function(a){return typeof a=="object"&&(a=JSON.stringify(a)),a},_.deserialize=function(a){try{a=JSON.parse(a)}catch{}return a},_.getViewName=function(){return window.location.pathname},_.getViewUrl=function(){return window.location.pathname},_.getSearchQuery=function(){return window.location.search},_.DeviceIdType={DEVELOPER_SUPPLIED:S.DEVELOPER_SUPPLIED,SDK_GENERATED:S.SDK_GENERATED,TEMPORARY_ID:S.TEMPORARY_ID},_})});var Nt=Yt(Ot(),1);var Xt="https://countly.ipfs.tech",It={url:Xt,autoTrack:!0,interval:5e3,max_events:500,queue_size:1e3,session_update:60,require_consent:!0};var Se=class{constructor(l){this.groupedFeatures=this.mapAllEvents({minimal:["sessions","views","events"],performance:["crashes","apm"],ux:["scrolls","clicks","forms"],feedback:["star-rating","feedback"],location:["location"]}),this.sessionStarted=!1,this._consentGranted=new Set,this.initDone=!1;let p=Object.assign(Object.assign(Object.assign({},It),l),{app_key:l.appKey}),{autoTrack:n,metricsService:S,storageProvider:w}=p;this.metricsService=S,this.storageProvider=w??null,this.metricsService.init(p),this.metricsService.group_features(this.groupedFeatures),n&&this.setupAutoTrack();let C=this.getConsentStore();C.length>0&&this.addConsent(C),this.initDone=!0}mapAllEvents(l){return Object.assign(Object.assign({},l),{all:Object.values(l).flat()})}get consentGranted(){return[...this._consentGranted]}setupAutoTrack(){var l,p,n,S,w;let C=this.metricsService;(l=C.track_clicks)===null||l===void 0||l.call(C),(p=C.track_forms)===null||p===void 0||p.call(C),(n=C.track_links)===null||n===void 0||n.call(C),(S=C.track_scrolls)===null||S===void 0||S.call(C),(w=C.track_sessions)===null||w===void 0||w.call(C),this.metricsService.track_errors(),this.metricsService.track_pageview(),this.metricsService.track_view()}addConsent(l){Array.isArray(l)||(l=[l]),l.forEach(p=>this._consentGranted.add(p)),this.metricsService.add_consent(l),this.setConsentStore()}removeConsent(l){Array.isArray(l)||(l=[l]),l.forEach(p=>this._consentGranted.delete(p)),this.metricsService.remove_consent(l,!0),this.setConsentStore()}setConsentStore(){this.storageProvider!=null&&this.initDone&&this.storageProvider.setStore(Array.from(this._consentGranted))}getConsentStore(){var l,p;return(p=(l=this.storageProvider)===null||l===void 0?void 0:l.getStore())!==null&&p!==void 0?p:[]}checkConsent(l){return l in this.groupedFeatures?this.groupedFeatures[l].every(this.metricsService.check_consent):this.metricsService.check_consent(l)}updateConsent(l){let p=new Set(l);Object.keys(this.groupedFeatures).forEach(n=>{p.has(n)?this.addConsent(n):this.removeConsent(n)})}trackView(l,p,n){this.metricsService.track_view(l,p,n)}trackEvent(l){this.metricsService.add_event(l)}trackError(l,p=!0,n={}){this.metricsService.recordError(l,p,n)}startSession(l=!1,p=!1){this.sessionStarted||(this.sessionStarted=!0,this.metricsService.begin_session(l,p))}endSession(l=!1){this.sessionStarted&&(this.metricsService.end_session(void 0,l),this.sessionStarted=!1)}};var Ce=class{setStore(l){try{let p=JSON.stringify(l);globalThis.localStorage.setItem("@ipfs-shipyard/ignite-metrics:consent",p)}catch(p){console.error(p)}}getStore(){try{let l=globalThis.localStorage.getItem("@ipfs-shipyard/ignite-metrics:consent");if(l!=null)return JSON.parse(l)}catch(l){console.error(l)}return["minimal"]}};var Ge=class extends Se{constructor(l){super(Object.assign({metricsService:Nt.default,storageProvider:new Ce},l))}};window.addEventListener("load",()=>{let _=new Ge({appKey:"b09437fd68bb257fef9b844a624fac0859b6224e"});window.telemetry=_,window.removeMetricsConsent=()=>_.removeConsent(["minimal"]),window.addMetricsConsent=()=>_.addConsent(["minimal"])});})();
